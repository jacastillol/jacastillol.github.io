---
title: "Vagrant for LAMP learning"
date: 2019-03-15
tags: [linux, servers, LAMP]
header:
  image: "/images/fort point.png"
excerpt: "Linux, Servers, LAMP"
mathjax: "true"
---

# Vagrang for LAMP Learning
In this notes you can find how to set up a Linux Box in Vagrant to prove a LAMP configuration fast and flexible.
## Requirements
1. VirtualBox installed
1. Vagrant installed (last version from [Vagrant](www.vagrantup.com) recommended)

## Create a new box
On the host machine create a new directory where you hold all the stuff related with the box
```bash
host-$ mkdir vgdemo
host-$ cd vgdemo
```
Now you can create a file called `Vagrantfile` which configure the box, this file is automatically generated with the command `vagrant init generic/ubuntu1804`. In this case a chose the box for Ubuntu 18.04.
```bash
host-$ vagrant init generic/ubuntu1804 
```
After removing some commets in the `Vagrantfile` you can indentify five main sections in the file:
1. Box Settings
1. Provider Settings
1. Network Settings
1. Folder Settings
1. Provision Settings

```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|

  # Box Settings
  config.vm.box = "generic/ubuntu1804"

  # Provider Settings
  config.vm.provider "virtualbox" do |vb|
    
  end

  # Network Settings
  # config.vm.network "forwarded_port", guest: 80, host: 8080
  # config.vm.network "forwarded_port", guest: 80, host: 8080, host_ip: "127.0.0.1"
  # config.vm.network "private_network", ip: "192.168.33.10"
  # config.vm.network "public_network"

  # Folder Settings
  # config.vm.synced_folder "../data", "/vagrant_data"

  # Provision Settings
  # config.vm.provision "shell", inline: <<-SHELL
  #   apt-get update
  #   apt-get install -y apache2
  # SHELL
end
```
With configuration file it is time to create the box with the following command
```bash
host-$ vagrant up 
```
this could take some minutes.
### Some comands after box creation that you can run
* `vagrant destroy`
* `vagrant suspend`
* `vagrant resume`
* `vagrant reload`

### Configurirng virtual harward of your box
For example you can set the amount of memory and number of cpus

```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|

  ...

  # Provider Settings
  config.vm.provider "virtualbox" do |vb|
    vb.memory = 2048
    vb.cpus = 4 
  end
  ...
end
```
After this don't forget you most reload the box `vagrant reload`.

### Configurirng the default packages of your box
You can install for example: git, Apache and others using the configuration file

```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|

  ...

  # Provision Settings
  config.vm.provision "shell", inline: <<-SHELL
    apt update
    apt install -y git
    apt install -y apache2
  SHELL
  ...
end
```
After this don't forget you most reload the box `vagrant reload`. Another more efficient option could be using a `bootstrap.sh` file
```ruby
  ...

  # Provision Settings
  config.vm.provision "shell", path: "bootstrap.sh"
  ...
```
As an example of a short `bootstrap.sh` file you can set
```bash
# Update Packages
apt update

# Upgrade Packages
apt upgrade

# Some Basic Packages
apt install -y git

# Apache
apt install -y apache2

# Enable Apache Mods
a2enmod rewrite

# PHP
apt install -y php
apt install -y libapache2-mod-php

# Restart Apache
service apache2 restart



```

### Accessing by ssh the first time
You can configure all your machine packages now, but you could use Provision settings on the configuration file
```bash
host-$ vagrant ssh
vagrant@ubuntu1804:~$
```

### Configurirng the network access of your box
In the configuration file you have to choose among four options, and supposing you have installed apache on your box:
```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|

  ...

  # Network Settings
  # config.vm.network "forwarded_port", guest: 80, host: 8080
  # config.vm.network "forwarded_port", guest: 80, host: 8080, host_ip: "127.0.0.1"
  # config.vm.network "private_network", ip: "192.168.33.10"
  # config.vm.network "public_network"
  ...
end
```
1. From localhost, uncomment only `config.vm.network "forwarded_port", guest: 80, host: 8080` where guest is the box and host is your real machine.
    Reload the box and now you can use `localhost:8080` on your real machine browser to see the apache server working.
1. From the prived network, uncomment only `config.vm.network "private_network", ip: "192.168.33.10"`.
    Reload the box and now you can use `192.168.33.10` on your real machine browser to see the apache server working.
    Maybe you can add a local Hostname on your real machine on the `/etc/hosts` and add the line `192.168.33.10 vgdemo.local wwww.vgdemo.local`.

After this don't forget you most reload the box `vagrant reload`.

### Configurirng a shared directory for your box
This example shows how to setup the `vgdemo` directory of your host as a shared folder and is pointing to `/var/www/html` 
```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|

  ...

  # Folder Settings
  config.vm.synced_folder ".", "/var/www/html"
  ...
end
```
After this don't forget you most reload the box `vagrant reload`. Now if you load the browser pointing this folder will point out to `vgdemo` and you can edit in your host an `index.html`.

You can improve the permission changing the line for:
```ruby
  # Folder Settings
  config.vm.synced_folder ".", "/var/www/html", :nfs => { :mount_options => ["dmode=777", "fmode=666"] }
```
you will need your local password.
